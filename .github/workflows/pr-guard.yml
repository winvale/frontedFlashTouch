name: ValidaciÃ³n de PRs

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]
    branches:
      - '**'

jobs:
  verificar-pr:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… Verificar si se hizo checkout
        run: |
          if [ ! -d ".git" ]; then
            echo "âŒ ERROR: Falta hacer 'actions/checkout'. Agrega este paso antes de usar comandos git."
            exit 1
          fi

      - name: ğŸ”„ Checkout del cÃ³digo
        uses: actions/checkout@v3

      - name: Verificar condiciones del PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ğŸ” Validando condiciones del PR..."

          TARGET_BRANCH="${{ github.event.pull_request.base.ref }}"
          SOURCE_BRANCH="${{ github.event.pull_request.head.ref }}"
          PR_NUMBER=${{ github.event.pull_request.number }}

          echo "ğŸ“Œ Target branch: $TARGET_BRANCH"
          echo "ğŸ“Œ Source branch: $SOURCE_BRANCH"

          if [[ "$TARGET_BRANCH" == "master" && ! "$SOURCE_BRANCH" =~ ^release\/.+$ ]]; then
            echo "âŒ Solo se puede mergear a master desde ramas release/*"
            exit 1
          fi

          echo "âœ… ValidaciÃ³n pasada"
